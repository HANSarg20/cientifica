<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Científica</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.0.0/math.min.js"></script>
    <style>
        /* Estilos CSS para la calculadora */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient to right, #4facfe 0%, #00f2fe 100%);
            margin: 0;
            color: #333;
        }

        .calculadora {
            background-color: #2d2d2d; /* Gris oscuro casi negro */
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.6);
            border: 1px solid #444;
            max-width: 400px; /* Limitar el ancho */
        }

        .pantalla {
            background-color: #4a4a4a; /* Gris un poco más claro para la pantalla */
            color: #00ff00; /* Verde brillante para el texto de la pantalla */
            font-size: 2.8em;
            text-align: right;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            min-height: 1.8em;
            display: flex;
            align-items: flex-end;
            justify-content: flex-end;
            word-wrap: break-word;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.4);
        }

        .historial {
            color: #999;
            font-size: 0.8em;
            min-height: 1.2em;
            text-align: right;
            margin-bottom: 5px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .botones {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 columnas para más botones */
            gap: 12px;
        }

        .boton {
            background-color: #555; /* Botones generales */
            color: #eee;
            font-size: 1.2em;
            padding: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            font-weight: bold;
        }

        .boton:hover {
            background-color: #777;
            transform: translateY(-2px);
        }

        .boton:active {
            transform: translateY(0);
        }

        .boton.operador {
            background-color: #ff9500; /* Naranja para operadores */
        }

        .boton.operador:hover {
            background-color: #e68600;
        }

        .boton.funcion {
            background-color: #007bff; /* Azul para funciones científicas */
            font-size: 1.0em; /* Fuente un poco más pequeña para funciones */
        }

        .boton.funcion:hover {
            background-color: #0069d9;
        }

        .boton.igual {
            grid-column: span 2; /* Ocupa dos columnas */
            background-color: #28a745; /* Verde para el igual */
        }

        .boton.igual:hover {
            background-color: #218838;
        }

        .boton.clear {
            background-color: #dc3545; /* Rojo para C */
        }

        .boton.clear:hover {
            background-color: #c82333;
        }

        .boton.backspace {
            background-color: #ffc107; /* Amarillo para borrar */
            color: #333; /* Texto oscuro */
        }
        .boton.backspace:hover {
            background-color: #e0a800;
        }
    </style>
</head>
<body>

    <div class="calculadora">
        <div class="historial" id="historial"></div>
        <div class="pantalla" id="pantalla">0</div>
        <div class="botones">
            <button class="boton clear" onclick="clearPantalla()">C</button>
            <button class="boton backspace" onclick="backspace()">←</button>
            <button class="boton funcion" onclick="agregarFuncion('sqrt(')">√</button>
            <button class="boton funcion" onclick="agregarFuncion('pow(')">xʸ</button>
            <button class="boton operador" onclick="agregarCaracter('/')">÷</button>

            <button class="boton funcion" onclick="agregarFuncion('sin(')">sin</button>
            <button class="boton funcion" onclick="agregarFuncion('cos(')">cos</button>
            <button class="boton funcion" onclick="agregarFuncion('tan(')">tan</button>
            <button class="boton funcion" onclick="agregarCaracter('PI')">π</button>
            <button class="boton operador" onclick="agregarCaracter('*')">×</button>

            <button class="boton" onclick="agregarCaracter('7')">7</button>
            <button class="boton" onclick="agregarCaracter('8')">8</button>
            <button class="boton" onclick="agregarCaracter('9')">9</button>
            <button class="boton funcion" onclick="agregarFuncion('log10(')">log</button>
            <button class="boton operador" onclick="agregarCaracter('-')">-</button>

            <button class="boton" onclick="agregarCaracter('4')">4</button>
            <button class="boton" onclick="agregarCaracter('5')">5</button>
            <button class="boton" onclick="agregarCaracter('6')">6</button>
            <button class="boton funcion" onclick="agregarFuncion('exp(')">eˣ</button>
            <button class="boton operador" onclick="agregarCaracter('+')">+</button>

            <button class="boton" onclick="agregarCaracter('1')">1</button>
            <button class="boton" onclick="agregarCaracter('2')">2</button>
            <button class="boton" onclick="agregarCaracter('3')">3</button>
            <button class="boton" onclick="agregarCaracter('(')">(</button>
            <button class="boton" onclick="agregarCaracter(')')">)</button>

            <button class="boton" onclick="agregarCaracter('0')">0</button>
            <button class="boton" onclick="agregarCaracter('.')">.</button>
            <button class="boton funcion" onclick="agregarCaracter('E')">E</button>
            <button class="boton igual" onclick="calcularResultado()">=</button>
        </div>
    </div>

    <script>
        // Lógica JavaScript para la calculadora
        const pantalla = document.getElementById('pantalla');
        const historial = document.getElementById('historial');
        let expresion = '';
        let esNuevoNumero = true; // Para saber si estamos escribiendo un nuevo número o continuando una operación

        // Función para agregar números o operadores
        function agregarCaracter(char) {
            if (pantalla.textContent === 'Error' || pantalla.textContent === 'NaN' || esNuevoNumero) {
                pantalla.textContent = '';
                expresion = '';
                esNuevoNumero = false;
            }

            // Evitar múltiples puntos decimales en el mismo número
            if (char === '.' && expresion.split(/[\+\-\*\/\(\)]/).pop().includes('.')) {
                return;
            }
            
            // Reemplazar operadores si el último caracter es un operador
            const lastChar = expresion.slice(-1);
            const operadores = ['+', '-', '*', '/', 'x', '÷'];
            if (operadores.includes(lastChar) && operadores.includes(char)) {
                expresion = expresion.slice(0, -1) + char;
            } else {
                expresion += char;
            }
            
            // Reemplazar PI y E con sus valores numéricos para math.js
            let displayExp = expresion.replace(/PI/g, 'π').replace(/E/g, 'e');
            pantalla.textContent = displayExp;
        }

        // Función para agregar funciones científicas
        function agregarFuncion(func) {
            if (pantalla.textContent === 'Error' || pantalla.textContent === 'NaN' || esNuevoNumero) {
                pantalla.textContent = '';
                expresion = '';
                esNuevoNumero = false;
            }
            expresion += func;
            pantalla.textContent += func.replace('pow(', '^').replace('sqrt(', '√'); // Mostrar de forma amigable
        }

        // Limpiar la pantalla
        function clearPantalla() {
            expresion = '';
            pantalla.textContent = '0';
            historial.textContent = '';
            esNuevoNumero = true;
        }

        // Borrar el último caracter
        function backspace() {
            if (expresion.length > 0 && pantalla.textContent !== 'Error' && pantalla.textContent !== 'NaN') {
                expresion = expresion.slice(0, -1);
                pantalla.textContent = expresion === '' ? '0' : expresion;
            }
        }

        // Calcular el resultado
        function calcularResultado() {
            try {
                // Preprocesar la expresión para Math.js
                // Reemplazar operadores de visualización por operadores de Math.js
                let expresionParaMathJs = expresion
                    .replace(/×/g, '*')
                    .replace(/÷/g, '/')
                    .replace(/√/g, 'sqrt')
                    .replace(/xʸ/g, 'pow')
                    .replace(/log/g, 'log10'); // Math.js usa log10 para logaritmo base 10

                // Evaluar la expresión usando math.evaluate
                let resultado = math.evaluate(expresionParaMathJs);

                // Manejar resultados con muchos decimales si es necesario
                if (typeof resultado === 'number' && !Number.isInteger(resultado)) {
                     resultado = parseFloat(resultado.toFixed(10)); // Limitar a 10 decimales
                }

                historial.textContent = pantalla.textContent + ' =';
                pantalla.textContent = String(resultado);
                expresion = String(resultado); // Guardar el resultado para futuras operaciones
                esNuevoNumero = true; // El próximo clic en un número empezará uno nuevo
            } catch (error) {
                historial.textContent = '';
                pantalla.textContent = 'Error';
                expresion = '';
                esNuevoNumero = true;
                console.error("Error de cálculo:", error); // Para depuración
            }
        }
    </script>
</body>
</html>
